version: 1
# frontend:
#   phases:
#     preBuild:
#       commands:
#         - corepack pnpm install --frozen-lockfile
#     build:
#       commands:
#         - corepack pnpm nx run-many --target=build-storybook --all=true
#   artifacts:
#     # IMPORTANT - Please verify your build output directory
#     baseDirectory: /dist/storybook/libs/@guardian/source-foundations
#     files:
#       - '**/*'
#   cache:
#     paths:
#       - codebuild/output/.pnpm-store/v3/**/*
applications:
  - appRoot: libs/@guardian/source-foundations
    frontend:
      phases:
        preBuild:
          commands:
            - cd ../../../
            - nvm install 16 # amplify doesn't support 18 and defaults to 14 :(
            - corepack pnpm install --frozen-lockfile
        build:
          commands:
            - corepack pnpm nx run @guardian/source-foundations:build-storybook
        postBuild:
          commands:
            - echo "$PWD"
            - ls
            - ls ./dist
      artifacts:
        files:
          - '**/*'
        discard-paths: yes
        baseDirectory: ./dist/storybook/libs/@guardian/source-foundations
      cache:
        paths:
          - codebuild/output/.pnpm-store/v3/**/*
